<style>
  #list-element {
    display: flex;
    flex-wrap: wrap;
  }

  .user {
    border: 2px solid crimson;
    padding: 10px;
    margin: 10px;
    width: 350px;
  }
</style>

<h1>REST API</h1>
<input type="text" id="user-id" value="" autocomplete="off" placeholder="Id" readonly>
<input type="text" id="user-name" placeholder="Name" autocomplete="off">
<input type="text" id="user-email" placeholder="Email" autocomplete="off">
<button id="insert-button" onclick="insertUser()">Založit uživatele</button>
<button id="update-button" onclick="updateUser()" style="display: none;">Upravit uživatele</button>

<div id="list-element"></div>


<script>

  function updateUser() {
    const user = {}
    user.id = document.getElementById("user-id").value;
    user.name = document.getElementById("user-name").value;
    user.email = document.getElementById("user-email").value;

    console.log(user);

    fetch('./api/07-rest-api/users/', {
      method: 'PUT', // *GET, POST, PUT, DELETE, etc.
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(user)
    })
    .then(response => console.log(response.text()))
    .then(() => document.getElementById("user-id").value = '')
    .then(() => document.getElementById("user-name").value = '')
    .then(() => document.getElementById("user-email").value = '')
    .then(() => document.getElementById("insert-button").style.display = 'inline-block')
    .then(() => document.getElementById("update-button").style.display = 'none')
    .then(() => reloadResource())
  }

  function insertUser() {
    const user = {}
    user.id = document.getElementById("user-id").value;
    user.name = document.getElementById("user-name").value;
    user.email = document.getElementById("user-email").value;

    console.log(user);

    fetch('./api/07-rest-api/users/', {
      method: 'POST', // *GET, POST, PUT, DELETE, etc.
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(user)
    })
    .then(response => console.log(response.text()))
    .then(() => document.getElementById("user-name").value = '')
    .then(() => document.getElementById("user-email").value = '')
    .then(() => document.getElementById("insert-button").style.display = 'inline-block')
    .then(() => document.getElementById("update-button").style.display = 'none')
    .then(() => reloadResource())
  }

  function reloadResource() {
    fetch('./api/07-rest-api/users/')
    .then(response => response.json())
    .then(data => convertToHtml(data))
    .then(html => {
      document.getElementById("list-element").innerHTML = '';
      return html
    })
    .then(data => data.forEach(item => document.getElementById("list-element").appendChild(item)))
  }

  function convertToHtml(objects) {
    let converted = [];
    for (const user of objects) {
      const div = document.createElement('DIV');
      div.innerHTML = `<div class="user"><h3>${user.name}</h3><span onclick="editUser(${user.id})">&#128397;</span><span onclick="deleteUser(${user.id})">&#10060;</span></div>`
      converted.push(div.firstChild);
    }
    console.log(converted);
    return converted;
  }

  function editUser(id) {
    console.log('./api/07-rest-api/users/' + id);
    fetch('./api/07-rest-api/users/' + id)
    .then(response => response.json())
    .then(object => {
      document.getElementById("user-id").value = object.id;
      document.getElementById("user-name").value = object.name;
      document.getElementById("user-email").value = object.email;
    })
    .then(() => document.getElementById("insert-button").style.display = 'none')
    .then(() => document.getElementById("update-button").style.display = 'inline-block')
  }

  function deleteUser(id) {
    console.log('./api/07-rest-api/users/' + id);
    fetch('./api/07-rest-api/users/' + id, {
      method: 'DELETE', // *GET, POST, PUT, DELETE, etc.
    })
    .then(() => reloadResource())
  }

  reloadResource();


</script>
